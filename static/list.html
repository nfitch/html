<!--
    Rapidly create and manage lists of things.  The primary goal:
    - UX should get out of the way of a user's stream of conscience.

    The implications:
    - All actions should be intuitive / brain mappable.
    - Interactions are all keboard based.
    - "Instantly" responsive.
    - No extra / extraneous keystrokes.

    This isn't meant to be a spreadsheet... if I could have used a spreadsheet
    in place of this I would have.

    As of 4/9/2023 this is day-to-day useable.

    I may or may not ever do this stuff, but, you know, everything needs its
    unfulfilled TODO list!
    - Help for new users (and me!)
    - Cut/Copy/Paste
    - CSV save/load (probably introduce an external dependency :sad-panda:)
    - Named Views (<2 clicks New/Save As/Load/Delete)
    - "Easy" Saving / Loading somewhere other than Local Storage
    - Type mode on/off switch
    - Slam cursor & selection to extremities w/single key combinations
    - Abstract the DOM interactions (super intertwined makes some things harder)
    - List headers (type when list is highlighted)
    - Multi Select & all the implications
    - Mouse Actions (drag/drop & select (ctrl to multi))
    - Action Stack + undo/redo
    - Checklist mode
    - Lists can have widths (some wider than others)
       - Will persist in Local Storage and JSON representations
    - Mouse interactions (click to select, multi-select, drag & drop, checklist)
    - Per-user keyboard binding remaps (emacs, vim bindings?)
    - Edit element as HTML (not sure if I really want to go there)

    Of course, the holy grail is an Excalidraw-like multi-user experience, but
    that would take real engineering... maybe someday...
  -->
<html>
  <head>
    <title>List</title>
    <link rel="stylesheet" href="./list/list-styling.css">
    <script type="module" src="./list/lists.js"></script>
    <script type="module" src="./list/key-handler.js"></script>
    <script type="text/javascript">
      const DEFAULT_FILENAME = "list.json";
      var lists;
      function init() {
          //Disable the form
          var cf = document.getElementById("control-form");
          cf.onkeypress = function (e) {
              e.preventDefault();
          }

          //Load the lists app at the list-outer element.
          lists = createLists(
              document.getElementById("list-outer"),
              localStorage
          );
          keyHandler = createKeyHandler(lists);

          document.addEventListener('keydown', keyHandler.handle);
          lists.init();
      }

      function resetList() {
          lists.resetList();
      }

      function saveJSON() {
          var dataStr = "data:text/json;charset=utf-8," +
              encodeURIComponent(lists.stringify());
          var downloadAnchorNode = document.createElement('a');
          downloadAnchorNode.setAttribute("href", dataStr);
          downloadAnchorNode.setAttribute("download", DEFAULT_FILENAME);
          document.body.appendChild(downloadAnchorNode); // required for firefox
          downloadAnchorNode.click();
          downloadAnchorNode.remove();
      }

      function loadJSON() {
          var lfs = document.getElementById("load-file-select");
          //We're only loading the first file
          var file = lfs.files[0];
          var fr = new FileReader();
          fr.onload = function (eve) {
              if (!lists.fromString(eve.target.result)) {
                  alert("Failed to load file.  Check console for errors.");
                  lists.resetList();
              }
          }
          fr.readAsText(file);
      }
    </script>
  </head>
  <body onload="init()">
    <form id="control-form">
      <input type="button" name="Reset" value="Reset" onClick="resetList()">
      <input type="button" name="Save" value="Save" onClick="saveJSON()">
      <input type="button" name="Load" value="Load"
             onClick="document.getElementById('load-file-select').click()">
      <input type="file" id="load-file-select" accept="text/json,.json"
             onchange="loadJSON()" style="display:none;">
    </form>
    <hr>
    <div id="list-outer" class="list-outer"></div>
  </body>
</html>
